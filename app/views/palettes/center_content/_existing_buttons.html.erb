<div id="paletteButtonsInCenterColumn">
  <div class="gridster">
    <ul>
      <% @palette.buttons.each do |button| %>
        <%= render 'buttons/gridster/widget', button: button %>
      <% end unless @palette.buttons.blank? %>
    </ul>
  </div>
</div>
<script>
  $(".gridster ul").gridster({
	  widget_margins: [1, 1],
    widget_base_dimensions: [50, 50],
    max_cols: 12,
    min_cols: 12,
    serialize_params: function($w, wgd) {
      return {
        id: $w.data('id'),
        col: wgd.col,
        row: wgd.row,
        size_x: wgd.size_x,
        size_y: wgd.size_y
      }
    },
    draggable: {
      stop: function(){
        var url = "<%= save_grid_palette_buttons_path current_user.last_viewed_palette %>";
        var data = "button_data="+JSON.stringify(
            $(".gridster ul").gridster().data('gridster').serialize_changed()
        );
        $.post(
            url,
            data,
            null,
            'script'
        )
      }
    }
  });
  <% if @palette.buttons.present? %>
    $('a#button-' + '<%= @palette.current_button.id %>').click();
  <% end %>
</script>
